<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${viewMode == 'view' ? 'Visualizar' : (viewMode == 'edit' ? 'Editar' : 'Adicionar')} + ' Categoria - BlueVelvet Music Store'">
        Categoria - BlueVelvet Music Store</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script th:src="@{/js/scripts.js}" defer></script>
</head>
<body>
<main>
    <div class="go-back">
        <a th:href="@{/dashboard}" class="link-clean">
            <span class="arrow left"></span> Voltar ao Dashboard
        </a>
    </div>

    <h1>üéµ BlueVelvet Music Store</h1>
    <h2 th:text="${viewMode == 'view' ? 'Visualizar Categoria' : (viewMode == 'edit' ? 'Editar Categoria' : 'Adicionar Categoria')}">
        Categoria</h2>

    <!-- Formul√°rio -->
    <form method="POST"
          th:action="@{${viewMode == 'edit' ? '/category/' + category.id : '/category'}}"
          th:object="${category}"
          enctype="multipart/form-data"
          class="category-form">

        <!-- ID (apenas visualiza√ß√£o) -->
        <div class="form-field" th:if="${viewMode == 'view' or viewMode == 'edit'}">
            <label for="id">ID</label>
            <input type="text" id="id" th:value="${category.id}" disabled class="disabled-field">
        </div>

        <!-- Nome da Categoria -->
        <div class="form-field">
            <label for="name">Nome da Categoria</label>
            <input type="text"
                   id="name"
                   name="name"
                   placeholder="Nome da Categoria"
                   th:value="${category.name}"
                   th:field="*{name}"
                   th:disabled="${viewMode == 'view'}"
                   required>
        </div>

        <!-- Imagem -->
        <div class="form-field">
            <label for="imageFile">Imagem</label>
            <div th:if="${viewMode != 'view'}">
                <input type="file"
                       id="imageFile"
                       name="imageFile"
                       accept="image/*"
                       onchange="previewImage(event)">
            </div>
            <div th:if="${viewMode == 'view'}">
                <input type="text" value="(Upload desabilitado no modo visualiza√ß√£o)" disabled class="disabled-field">
            </div>

            <!-- Preview da imagem atual (edit e view) -->
            <div th:if="${(viewMode == 'edit' or viewMode == 'view') and category.image != null and !#strings.isEmpty(category.image)}"
                 class="image-container">
                <small>Imagem atual:</small><br>
                <img th:src="@{'/uploads/' + ${category.image}}" alt="Imagem atual" class="image-preview">
            </div>

            <!-- Preview da nova imagem (create e edit) -->
            <div th:if="${viewMode != 'view'}" id="imagePreview" class="image-container" style="display: none;">
                <small>Preview da nova imagem:</small><br>
                <img id="preview" src="" alt="Preview" class="image-preview">
            </div>

            <!-- Sem imagem (view) -->
            <div th:if="${viewMode == 'view' and (category.image == null or #strings.isEmpty(category.image))}"
                 class="no-image-message">
                <small>Nenhuma imagem cadastrada</small>
            </div>
        </div>

        <!-- Categoria Pai -->
        <div class="form-field">
            <label for="parentId">Categoria Pai</label>
            <div th:if="${viewMode == 'view'}">
                <input type="text"
                       th:value="${parentCategory != null ? parentCategory.name : 'Nenhuma (Categoria Raiz)'}"
                       disabled
                       class="disabled-field">
            </div>
            <div th:if="${viewMode != 'view'}">
                <select id="parentId"
                        name="parentId"
                        th:field="*{parentId}"
                        th:disabled="${viewMode == 'view'}">
                    <option value="">-- Nenhuma (Raiz) --</option>
                    <option th:each="parent : ${parentCategories}"
                            th:value="${parent.id}"
                            th:text="${parent.name}"
                            th:unless="${viewMode == 'edit' and parent.id == category.id}">
                    </option>
                </select>
            </div>
        </div>

        <!-- Tipo (apenas visualiza√ß√£o) -->
        <div class="form-field" th:if="${viewMode == 'view'}">
            <label>Tipo</label>
            <input type="text"
                   th:value="${category.isRoot ? 'üìÅ Categoria Raiz' : 'üìÇ Subcategoria'}"
                   disabled
                   class="disabled-field">
        </div>

        <!-- Habilitada -->
        <fieldset id="enabled" th:disabled="${viewMode == 'view'}">
            <legend>Habilitada</legend>

            <div class="radio-option">
                <input type="radio"
                       id="yes"
                       name="enabled"
                       value="true"
                       th:field="*{enabled}"
                       th:checked="*{enabled}"
                       th:disabled="${viewMode == 'view'}">
                <label for="yes">Sim</label>
            </div>

            <div class="radio-option">
                <input type="radio"
                       id="no"
                       name="enabled"
                       value="false"
                       th:field="*{enabled}"
                       th:checked="!*{enabled}"
                       th:disabled="${viewMode == 'view'}">
                <label for="no">N√£o</label>
            </div>
        </fieldset>

        <!-- Status Badge (apenas visualiza√ß√£o) -->
        <div th:if="${viewMode == 'view'}" class="status-container">
            <label>Status</label>
            <div>
                <span th:if="${category.enabled}" class="status-badge status-enabled">
                    ‚úì Habilitada
                </span>
                <span th:unless="${category.enabled}" class="status-badge status-disabled">
                    ‚úó Desabilitada
                </span>
            </div>
        </div>

        <!-- Bot√µes -->
        <div class="bottom-buttons">
            <!-- Bot√£o de a√ß√£o (Salvar/Atualizar) -->
            <button th:if="${viewMode != 'view'}"
                    type="submit"
                    th:text="${viewMode == 'edit' ? 'Atualizar' : 'Salvar'}">
                Salvar
            </button>

            <!-- Bot√£o Editar (apenas no modo view) -->
            <a th:if="${viewMode == 'view'}"
               th:href="@{'/category/' + ${category.id} + '/edit'}"
               class="link-flex">
                <button type="button" class="button-full-width">‚úèÔ∏è Editar</button>
            </a>

            <!-- Bot√£o Deletar (view e edit) -->
            <form th:if="${viewMode == 'view' or viewMode == 'edit'}"
                  th:action="@{'/category/' + ${category.id} + '/delete'}"
                  method="POST"
                  class="form-inline"
                  onsubmit="return confirm('Tem certeza que deseja deletar esta categoria?');">
                <button type="submit" class="delete-btn button-full-width">üóëÔ∏è Deletar</button>
            </form>

            <!-- Bot√£o Cancelar/Voltar -->
            <button type="button" onclick="window.location.href='/dashboard'">
                <span th:text="${viewMode == 'view' ? 'Voltar' : 'Cancelar'}">Cancelar</span>
            </button>
        </div>

    </form>
</main>
</body>
</html>

