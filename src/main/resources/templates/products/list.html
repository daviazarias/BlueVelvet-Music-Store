<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Produtos - BlueVelvet Music Store</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script th:src="@{/js/scripts.js}" defer></script>
</head>
<body>
<main>
    <h1>üéµ BlueVelvet Music Store</h1>
    <h2>Gerenciamento de Produtos</h2>

    <!-- Mensagens Flash -->
    <div class="message-success" th:if="${successMessage}" th:text="${successMessage}"></div>
    <div class="message-error" th:if="${errorMessage}" th:text="${errorMessage}"></div>

    <!-- Controles de Produto -->
    <div id="productControls">
        <form method="GET" class="search-form" th:action="@{/products}">
            <button class="button-auto" type="submit">Buscar</button>
            <label for="search"></label><input id="search" name="search" placeholder="Buscar por nome de produto..."
                                               th:value="${search}" type="text">
            <label for="sortSelect"></label><select id="sortSelect" name="sort" th:onchange="updateSort()">
            <option th:selected="${sort == 'name'}" value="name">Ordenar por Nome</option>
            <option th:selected="${sort == 'id'}" value="id">Ordenar por ID</option>
        </select>
            <button class="button-auto" th:onclick="clearSearch()" type="button">Limpar</button>
        </form>

        <a class="link-clean" th:href="@{/products/create}">
            <button id="addProductBtn" type="button">Adicionar Produto</button>
        </a>
    </div>

    <!-- Tabela de Produtos -->
    <table id="productTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Categoria</th>
            <th>Pre√ßo</th>
            <th>Estoque</th>
            <th>Habilitado</th>
            <th>A√ß√µes</th>
        </tr>
        </thead>
        <tbody id="productList">
        <tr th:each="product : ${products}">
            <td th:text="${product.id}"></td>
            <td th:text="${product.name}"></td>
            <td th:text="${product.categoryName}"></td>
            <td th:text="${'R$ ' + #numbers.formatDecimal(product.price, 1, 2, 'POINT')}"></td>
            <td th:text="${product.stockQuantity}"></td>
            <td>
                <span class="status-text-enabled" th:if="${product.enabled}">‚úì Sim</span>
                <span class="status-text-disabled" th:unless="${product.enabled}">‚úó N√£o</span>
            </td>
            <td>
                <a class="link-clean" th:href="@{'/products/' + ${product.id}}">
                    <button type="button">Visualizar</button>
                </a>
                <a class="link-clean" th:href="@{'/products/' + ${product.id} + '/edit'}">
                    <button type="button">Editar</button>
                </a>
                <form method="POST"
                      onsubmit="return confirm('Tem certeza que deseja deletar este produto?');"
                      class="form-inline"
                      th:action="@{'/products/' + ${product.id} + '/delete'}">
                    <button class="delete-btn" type="submit">Deletar</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Pagina√ß√£o -->
    <div id="pagination">
        <button th:if="${currentPage > 0}" th:onclick="goToProductPage(0)">Primeira...</button>
        <button th:if="${currentPage > 0}" th:onclick="goToProductPage(${currentPage - 1})">Anterior</button>

        <button th:class="${page == currentPage} ? 'active' : ''"
                th:each="page : ${#numbers.sequence(0, totalPages - 1)}"
                th:onclick="goToProductPage(${page})"
                th:text="${page + 1}">
        </button>

        <button th:if="${currentPage < totalPages - 1}" th:onclick="goToProductPage(${currentPage + 1})">Pr√≥xima
        </button>
        <button th:if="${currentPage < totalPages - 1}" th:onclick="goToProductPage(${totalPages - 1})">...√öltima
        </button>
    </div>

    <!-- Link para voltar -->
    <div class="back-link">
        <a href="/dashboard">‚Üê Voltar para Dashboard</a>
    </div>
</main>

<script>
    function goToProductPage(page) {
        const search = new URLSearchParams(window.location.search).get('search');
        const sort = new URLSearchParams(window.location.search).get('sort');
        let url = '/products?page=' + page;
        if (sort) url += '&sort=' + sort;
        if (search) url += '&search=' + search;
        window.location.href = url;
    }

    function updateSort() {
        const sort = document.getElementById('sortSelect').value;
        window.location.href = '/products?sort=' + sort;
    }

    function clearSearch() {
        window.location.href = '/products';
    }
</script>
</body>
</html>
