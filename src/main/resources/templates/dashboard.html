<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - BlueVelvet Music Store</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script th:src="@{/js/scripts.js}" defer></script>
</head>
<body>
<main>
    <h1>ðŸŽµ BlueVelvet Music Store</h1>
    <h2>Gerenciamento de Categorias</h2>

    <!-- SeÃ§Ã£o de Boas-vindas com usuÃ¡rio logado -->
    <div class="welcome-container">
        <div>
            <strong th:text="'Bem-vindo, ' + ${userName}"></strong>
            <span th:text="' (' + ${role} + ')'"></span>
        </div>
        <div class="welcome-actions">
            <a class="link-clean" th:href="@{/users/create}">
                <button id="addUserBtn" type="button">Adicionar UsuÃ¡rio</button>
            </a>
            <a class="link-clean" th:href="@{/products}">
                <button id="productsBtn" type="button">Gerenciar Produtos</button>
            </a>
            <form method="POST" class="form-no-margin" th:action="@{/logout}">
                <button id="logoutBtn" type="submit">Logout</button>
            </form>
        </div>
    </div>

    <!-- Mensagens Flash -->
    <div class="message-success"
         th:if="${successMessage}"
         th:text="${successMessage}"></div>
    <div class="message-error"
         th:if="${errorMessage}"
         th:text="${errorMessage}"></div>


    <!-- Controles de Categoria -->
    <div id="categoryControls">
        <form method="GET" class="search-form" th:action="@{/dashboard/search}">
            <button class="button-auto" type="submit">Buscar</button>

            <label for="search"></label>
            <input id="search" name="q" placeholder="Buscar por nome de categoria..." th:value="${search}" type="text">

            <label for="sortSelect"></label>
            <select id="sortSelect" name="sort" th:onchange="updateSort()">
                <option th:selected="${sort == 'name'}" value="name">Ordenar por Nome</option>
                <option th:selected="${sort == 'id'}" value="id">Ordenar por ID</option>
            </select>

            <label for="ordSelect"></label>
            <select id="ordSelect" name="asc" th:onchange="updateSort()">
                <option th:selected="${asc}" th:value=true>Ordenar ascendente</option>
                <option th:selected="${!asc}" th:value=false>Ordenar descendente</option>
            </select>

            <button class="button-auto" th:onclick="clearSearch()" type="button">Limpar</button>
        </form>

        <form method="POST" onsubmit="return confirm('Tem certeza que deseja resetar as categorias?');"
              class="form-inline"
              th:action="@{/category/reset}">
            <button id="resetProductsBtn" type="submit">Reset para Estado Inicial</button>
        </form>

        <a class="link-clean" th:href="@{/create-category}">
            <button id="addCategoryBtn" type="button">Adicionar Categoria</button>
        </a>

        <a class="link-clean" th:href="@{/category/export/csv}">
            <button id="exportCsvBtn" type="button">Exportar CSV</button>
        </a>

        <a class="link-clean" th:href="@{/products}">
            <button id="viewProductsBtn" type="button">Ver Produtos</button>
        </a>

        <a class="link-clean" th:href="@{/list}">
            <button id="listCategoriesBtn" type="button">Ver Lista de Categorias</button>
        </a>
    </div>

    <!-- Tabela de Categorias -->
    <table id="categoryTable">
        <thead>
        <tr>
            <th>Imagem</th>
            <th>Nome</th>
            <th>ID</th>
            <th>Habilitada</th>
            <th>AÃ§Ãµes</th>
        </tr>
        </thead>
        <tbody id="categoryList">
        <tr th:each="category : ${categories}">
            <td>
                <img class="image-thumbnail"
                     th:alt="${category.name}"
                     th:if="${category.image}"
                     th:src="@{'/uploads/' + ${category.image}}">
                <span th:unless="${category.image}">N/A</span>
            </td>
            <td th:text="${category.name}"></td>
            <td th:text="${category.id}"></td>
            <td>
                <span class="status-text-enabled" th:if="${category.enabled}">âœ“ Sim</span>
                <span class="status-text-disabled" th:unless="${category.enabled}">âœ— NÃ£o</span>
            </td>
            <!-- Na tabela de categorias, na coluna de AÃ§Ãµes: -->
            <td>
                <a class="link-clean" th:href="@{'/category/' + ${category.id}}">
                    <button type="button">Visualizar</button>
                </a>
                <a class="link-clean" th:href="@{'/category/' + ${category.id} + '/edit'}">
                    <button type="button">Editar</button>
                </a>
                <form method="POST"
                      onsubmit="return confirm('Tem certeza que deseja deletar esta categoria?');"
                      class="form-inline"
                      th:action="@{'/category/' + ${category.id} + '/delete'}">
                    <button class="delete-btn" type="submit">Deletar</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- PaginaÃ§Ã£o -->
    <div id="pagination">
        <button th:if="${currentPage > 0}" th:onclick="'goToPage(0)'">Primeira...</button>
        <button th:if="${currentPage > 0}" th:onclick="'goToPage(' + ${currentPage - 1} + ')'">Anterior</button>

        <button th:class="${page == currentPage} ? 'active' : ''"
                th:each="page : ${#numbers.sequence(0, totalPages - 1)}"
                th:onclick="'goToPage(' + ${page} + ')'"
                th:text="${page + 1}">
        </button>

        <button th:if="${currentPage < totalPages - 1}" th:onclick="'goToPage(' + ${currentPage + 1} + ')'">PrÃ³xima</button>
        <button th:if="${currentPage < totalPages - 1}" th:onclick="'goToPage(' + ${totalPages - 1} + ')'">...Ãšltima</button>
    </div>
</main>
</body>
</html>
